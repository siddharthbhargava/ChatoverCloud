<html>
<head>
<style type="text/css">
div#list {
  background-color: #1ADEAF;
  color: #000;
  overflow: scroll;
  width: 15em;
  height: 10em;
  padding: 10px;
  text-align: right bottom;
}

div.ex
{
width:180px;
padding:1px;
border:5px solid gray;
margin:0px;
}
    
</style>

<title>chat app </title>


<script type="text/javascript">
var req;
function addText(abcd) {

  olist = document.getElementById('list');
  op = document.createElement('p');
  op.innerHTML = "You : " + document.frmOne.tb1.value;
  ocontent = document.getElementById('content');
  ocontent.appendChild(op);
  olist.scrollTop = olist.scrollHeight;
  params="message="+document.frmOne.tb1.value;
  callCloudAjax("http://ec2-54-219-134-234.us-west-1.compute.amazonaws.com:3000/customerrequest",params,processRequest);
  
} 

function addResponse(resp) {

  olist = document.getElementById('list');
  op = document.createElement('p');
  op.innerHTML = "Server : " + resp;
  ocontent = document.getElementById('content');
  ocontent.appendChild(op);
  olist.scrollTop = olist.scrollHeight;
 
} 


function initRequest() 
{
	if (window.XMLHttpRequest) 
	{
		return new XMLHttpRequest();
	} 
	else 
	{
		if (window.ActiveXObject) 
		{
			isIE = true;
			return new ActiveXObject("Microsoft.XMLHTTP");
		}
	}

}

function callCloudAjax(url, params, process) 
{
	if(process!=null)
	{
		
		req = initRequest();
		req.onreadystatechange = process;
		req.open("POST",url,true);
		req.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		req.send(params);
	}
}

function processRequest() 
{
	if (req.readyState == 4) 
	{
		if (req.status == 200) 
		{
			results = req.responseText;
			if (results != null) 
			{
				var results_array = results.split(",");
				var value = trim(results);
				if ((value != "") && (value.length != 0)) 
				{
					if (results_array[0] == "1") 
					{
						alert(results_array[1]);
					}
					else
					{
						addResponse(results_array[1]);
					} 
				}
			}
		} 
		else 
		{	
       		alert("Problems communicating with Cloud server");
       		return false;
		}
	}
} 

function trim(x) {
    return x.replace(/^\s+|\s+$/gm,'');
}
</script>

</head> 

<body>
<form name = "frmOne">
<p>CMPE 272 Project</p>

<div id="list">
  <div id="content">
  <p class="other_user">CMPE 272 - Chat Window</p>
  <p class="other_user">Hello?</p>
  <p class="other_user">Is anybody there?</p>
  </div>
</div>
<p>
<div class="ex"><input id = "tb1" type="text" size = 30px value="" name = "textBox1"/></div><div><input type="button" value="Enter" onclick="addText(this)" /></div>
 
</form>
</body>

</html>
